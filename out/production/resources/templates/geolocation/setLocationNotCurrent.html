<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head>

    <title>Map my Spot</title>
</head>
<body>

<!--<form id="userInput" method="post" action ="">-->
<form id="userInput" method="post" action ="notCurrent">
    <label th:for="spotName">Name your spot: </label><br/>
    <input th:type="text" th:name="spotName" id="spotName"/><br/>
    <label th:for="spotInfo">Any info about you spot: </label><br/>
    <textarea rows="4" cols="50" th:name="spotInfo" id="spotInfo">
</textarea><br/>





</form>
<p id="savedSpot" name="savedSpot"></p>

<div id="map" style="width:400px;height:400px;"></div>

<p id="demo"></p><br/>

<p id="buttonLabel" name="buttonLabel">Click the button to save your spot.</p><br/>
<input type="button" value="Save Spot!" name="Save" id="Save"/>


</body>


<script th:src="@{/webjars/jquery/2.2.1/jquery.min.js}"></script>
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyArfm36_TyrJ7GhWvZPVYcWYYc5_ou2daw&amp;sensor=false"> </script>

<script th:inline="javascript" >
    /*<![CDATA[*/


    let x = document.getElementById("demo");
    let savedSpot = document.getElementById("savedSpot");
    var name = '<%= session.getAttribute("userLoggedIn") %>'
    console.log(name);

    //let n = 1;
    document.getElementById('Save').onclick = SaveSpot;
    start();

    function start() {
        getLocation()
    }
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {

        lat = position.coords.latitude;
        long = position.coords.longitude;



        myMap(lat, long);
    }

    function myMap(lat, long) {
        var location = {lat: lat, lng: long};
        var mapOptions = {
            center: new google.maps.LatLng(lat, long),
            zoom: 10,
            mapTypeId: google.maps.MapTypeId.HYBRID
        }
        var map = new google.maps.Map(document.getElementById("map"), mapOptions);
        addMarker(location, map);
    }

    function addMarker(location, map) {
        window.marker = new google.maps.Marker({
            position: location,
            label: "HERE",
            map: map,
            draggable: true,
            animation: google.maps.Animation.DROP
        });


        google.maps.event.addListener(marker, 'dragend', function (event) {

            console.log(event.latLng.lat());

            console.log(event.latLng.lng());

            long = event.latLng.lng();
            lat = event.latLng.lat();
            x.innerHTML = "Latitude: " + lat +
                "<br/>Longitude: " + long;

            //infoWindow.open(map, marker);

        });}
        function SaveSpot(){
            window.y = document.getElementById("spotName").value;
            window.z= document.getElementById("spotInfo").value;
            Save.parentNode.removeChild(Save);
            buttonLabel.parentNode.removeChild(buttonLabel);
            savedSpot.innerHTML = "Your spot was saved!";

        let jsonObject = {
            "spotName": z,
            "spotInfo": y,
            "longitude": long,
            "latitude": lat
        };
        console.log(lat, long, y, z);


        $.ajax ({
            //url: "test.html",
            url: "notCurrent",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(jsonObject),
            async: false,
            cache: false,
            processData: false,


        });}

        google.maps.event.addListener(marker, 'dragend', function (event) {

            console.log(event.latLng.lat());

            console.log(event.latLng.lng());

        });


  console.log(lat, long, y, z);


   $.ajax ({
       url: "test.html",
       type: "POST",
       contentType: "application/json; charset=utf-8",
       data: JSON.stringify(jsonObject),
       async: false,
       cache: false,
       processData: false,

  });

    /*]]>*/

</script>


</html>
